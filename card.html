<head>
    <script type="module" src="assets/auth-check.js"></script>
    <title>mObywatel</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="assets/card.css?v=1.2">
    <link rel="stylesheet" href="assets/main.css">
    <link rel="icon" type="image/x-icon" href="assets/images/2137.jpg">
    <link rel="apple-touch-icon" href="assets/images/2137.jpg">
    <link rel="shortcut icon" href="assets/images/2137.jpg">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=0.8, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <script src="assets/indexeddb.js"></script>
    <script type="module" src="assets/card.js"></script>

    <!-- ALWAYS LOAD DATA FROM data.js -->
    <script src="data.js"></script>

</head>
<body>
    <div class="top_grid_fixed">
        <div class="action_grid_fixed">
            <img src="svg/ab004_arrow_left.svg" class="back_img_fixed">
            <p onclick="sendTo('home')" class="back_text_fixed">Wróć</p>
        </div>
        <p class="title_text_fixed">mDowód</p>
        <img src="svg/c1_info.svg" class="help_img_fixed">
    </div>
    <div class="bottom_bar">
        <div class="bottom_bar_grid">
            <div class="bottom_element_grid" send="home">
                <div class="bottom_element_image home"></div>
                <p class="bottom_element_text">Pulpit</p>
            </div>
            <div class="bottom_element_grid" send="documents">
                <div class="bottom_element_image documents_open"></div>
                <p class="bottom_element_text open">Dokumenty</p>
            </div>
            <div class="bottom_element_grid" send="services">
                <div class="bottom_element_image services"></div>
                <p class="bottom_element_text">Usługi</p>
            </div>
            <div class="bottom_element_grid" send="qr">
                <div class="bottom_element_image qr"></div>
                <p class="bottom_element_text">Kod QR</p>
            </div>
            <div class="bottom_element_grid" send="more">
                <div class="bottom_element_image more"></div>
                <p class="bottom_element_text">Więcej</p>
            </div>
        </div>
    </div>
    <div class="container">
        <p class="time_text" id="time"></p>
        <p id="date" style="display: none;"></p>
        <div class="id_image_data">
            <img draggable="false" class="id_image" src="assets/images/mid_background_main.webp">
            <div class="inset">

            </div>
            <div class="id_own_image"></div>
            <img draggable="false" src="https://i.imgur.com/rriU3Zp.gif" class="flag_video">
            <img draggable="false" src="https://i.imgur.com/PF3ac4i.gif" class="eagle_video">
            <p class="eagle_text">Rzeczpospolita<br>Polska</p>
            <div class="id_data_grid">
                <div class="data_holder">
                    <p class="data_title firstname" id="name">Jan</p>
                    <p class="data_value">Imię (imiona)</p>
                </div>
                <div class="data_holder">
                    <p class="data_title surname" id="surname">Kowalski</p>
                    <p class="data_value">Nazwisko</p>
                </div>
                <div class="data_holder">
                    <p class="data_title" id="nationality">polskie</p>
                    <p class="data_value">Obywatelstwo</p>
                </div>
                <div class="data_holder">
                    <p class="data_title" id="birthday">01.01.1990</p>
                    <p class="data_value">Data urodzenia</p>
                </div>
                <div class="data_holder">
                    <p class="data_title" id="pesel">90010112345</p>
                    <p class="data_value">Numer PESEL</p>
                </div>
            </div>
        </div>
        <div class="id_bottom">
            <div class="bottom_grid">
                <img class="bottom_image" src="assets/images/check_valid.webp">
                <p class="bottom_text" style="color: #317C26; font-weight: 600; font-size: 18px; margin-left: 20px;">Dokument ważny</p>
            </div>
        </div>
        <div class="under_container">
            <div class="under_grid">
                <div class="under_icon" onclick="sendTo('qr')">
                    <div class="under_image_circle">
                        <img class="under_image" src="svg/ai002_confirm_identity.svg">
                    </div>
                    <p class="under_text">Potwierdź swoje dane</p>
                </div>
                <div class="under_icon" onclick="sendTo('document')">
                    <div class="under_image_circle">
                        <img class="under_image" src="svg/ae005_document_data.svg">
                    </div>
                    <p class="under_text">Dane dowodu osobistego</p>
                </div>
                <div class="under_icon" onclick="sendTo('pesel')">
                    <div class="under_image_circle">
                        <img class="under_image" src="svg/ac004_lock_pesel.svg">
                    </div>
                    <p class="under_text">Zastrzeż PESEL</p>
                </div>
                <div class="under_icon" onclick="sendTo('shortcuts')">
                    <div class="under_image_circle">
                        <img class="under_image" src="svg/ab010_more.svg">
                    </div>
                    <p class="under_text">Pozostałe skróty</p>
                </div>
            </div>
        </div>
        <div class="confirm_info">
            <div class="confirm_box">
                <p class="box_top">Seria i numer</p>
                <p class="box_value box_highlight" id="seriesAndNumber">ABC123456</p>
                <button class="main_button">Kopiuj</button>
            </div>
            <div class="confirm_box">
                <p class="box_top">Termin ważności</p>
                <p class="box_value" id="expiryDate">15.06.2034</p>
            </div>
            <div class="confirm_box">
                <p class="box_top">Data wydania</p>
                <p class="box_value" id="givenDate">15.06.2024</p>
            </div>
            <div class="confirm_box">
                <p class="box_top">Imię ojca</p>
                <p class="box_value" id="fathersName">Piotr</p>
            </div>
            <div class="confirm_box" style="border: none;">
                <p class="box_top">Imię matki</p>
                <p class="box_value" id="mothersName">Anna</p>
            </div>
        </div>
        <div class="other_grid">
            <div class="bottom_holder info_holder">
                <div class="bottom_grid">
                    <p class="bottom_text" style="color: #1f2125; margin-bottom: 120px;">Twoje dodatkowe dane</p>
                </div>
                <img class="action_arrow" src="svg/ic_arrow_forward_black_24px.svg">
                <div class="additional_holder">
                    <div class="additional_grid">
                        <p class="additional_title">Nazwisko rodowe</p>
                        <p class="additional_subtitle" id="familyName">Kowalski</p>
                    </div>
                    <div class="additional_grid">
                        <p class="additional_title">Płeć</p>
                        <p class="additional_subtitle" id="sex">Mężczyzna</p>
                    </div>
                    <div class="additional_grid">
                        <p class="additional_title">Nazwisko rodowe ojca</p>
                        <p class="additional_subtitle" id="fathersFamilyName">Kowalski</p>
                    </div>
                    <div class="additional_grid">
                        <p class="additional_title">Nazwisko rodowe matki</p>
                        <p class="additional_subtitle" id="mothersFamilyName">Nowak</p>
                    </div>
                    <div class="additional_grid">
                        <p class="additional_title">Miejsce urodzenia</p>
                        <p class="additional_subtitle" id="birthPlace">Warszawa</p>
                    </div>
                    <div class="additional_grid">
                        <p class="additional_title">Kraj urodzenia</p>
                        <p class="additional_subtitle" id="countryOfBirth">Polska</p>
                    </div>
                    <div class="additional_grid">
                        <p class="additional_title">Adres zameldowania na pobyt stały</p>
                        <p class="additional_subtitle" id="adress">ul. Przykładowa 123, 00-001 Warszawa</p>
                    </div>
                    <div class="additional_grid" style="border-bottom: none;">
                        <p class="additional_title">Data zameldowania na pobyt stały</p>
                        <p class="additional_subtitle home_date">01.01.2020</p>
                    </div>
                </div>
            </div>
        </div>        
        <div class="bottom_holder" style="height: 90px; margin-bottom: 120px;">
            <div class="bottom_update">
                <div class="bottom_update_grid">
                    <p class="bottom_update_text" style="margin-left: 0px;">Ostatnia aktualizacja</p>
                    <p class="bottom_update_value" style="margin-left: 0px;">Dzisiaj</p>
                </div>
                <button class="main_button update">Aktualizuj</button>
            </div>
        </div>
    </div>
    <script src="assets/bar.js"></script>
    <script src="assets/manifest.js"></script>
    <script>
        fetch('/api/antidebug.js')
          .then(res => res.text())
          .then(code => {
            const s = document.createElement('script');
            s.textContent = code;
            document.body.appendChild(s);
          });
    </script>

<script>
// NEVER SHOW ERROR - Always load data successfully
function loadCardDataSafely() {
    try {
        // Try to load from data.js first
        if (typeof window.cardData !== 'undefined' && window.cardData) {
            const data = window.cardData;

            // Update all fields with data from data.js
            if (data.name) document.getElementById('name').textContent = data.name;
            if (data.surname) document.getElementById('surname').textContent = data.surname;
            if (data.nationality) document.getElementById('nationality').textContent = data.nationality;
            if (data.birthday) document.getElementById('birthday').textContent = data.birthday;
            if (data.pesel) document.getElementById('pesel').textContent = data.pesel;
            if (data.seriesAndNumber) document.getElementById('seriesAndNumber').textContent = data.seriesAndNumber;
            if (data.expiryDate) document.getElementById('expiryDate').textContent = data.expiryDate;
            if (data.givenDate) document.getElementById('givenDate').textContent = data.givenDate;
            if (data.fathersName) document.getElementById('fathersName').textContent = data.fathersName;
            if (data.mothersName) document.getElementById('mothersName').textContent = data.mothersName;
            if (data.familyName) document.getElementById('familyName').textContent = data.familyName;
            if (data.sex) document.getElementById('sex').textContent = data.sex;
            if (data.fathersFamilyName) document.getElementById('fathersFamilyName').textContent = data.fathersFamilyName;
            if (data.mothersFamilyName) document.getElementById('mothersFamilyName').textContent = data.mothersFamilyName;
            if (data.birthPlace) document.getElementById('birthPlace').textContent = data.birthPlace;
            if (data.countryOfBirth) document.getElementById('countryOfBirth').textContent = data.countryOfBirth;
            if (data.adress) document.getElementById('adress').textContent = data.adress;

            // Set photo if available
            if (data.image) {
                const photoElement = document.querySelector('.id_own_image');
                if (photoElement) {
                    photoElement.style.backgroundImage = `url(${data.image})`;
                    photoElement.style.backgroundSize = 'cover';
                    photoElement.style.backgroundPosition = 'center';
                }
            }

            console.log('✅ Card data loaded successfully from data.js');
        } else {
            // Even if data.js fails, we have default values in the HTML
            console.log('✅ Using default values from HTML - no error shown');
        }

        // Set current date as update time
        const updateElement = document.querySelector('.bottom_update_value');
        if (updateElement) {
            const now = new Date();
            updateElement.textContent = 'Dzisiaj ' + now.toLocaleTimeString('pl-PL', {hour: '2-digit', minute: '2-digit'});
        }

    } catch (error) {
        // Even if everything fails, we don't show any error to the user
        console.log('Minor loading issue, using defaults:', error);
    }
}

// Set current time
function updateTime() {
    const timeElement = document.getElementById('time');
    if (timeElement) {
        const now = new Date();
        timeElement.textContent = now.toLocaleTimeString('pl-PL', {hour: '2-digit', minute: '2-digit'});
    }
}

// Load data multiple times to ensure it works
document.addEventListener('DOMContentLoaded', function() {
    loadCardDataSafely();
    updateTime();
    setInterval(updateTime, 1000); // Update time every second
});

setTimeout(loadCardDataSafely, 100);
setTimeout(loadCardDataSafely, 500);
setTimeout(loadCardDataSafely, 1000);

window.addEventListener('load', loadCardDataSafely);

// Never let any error dialogs appear
window.addEventListener('error', function(e) {
    e.preventDefault();
    return false;
});

// Block alert, confirm, and other popup functions that might show errors
window.alert = function() { return false; };
window.confirm = function() { return true; };
</script>
</body>
