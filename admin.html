<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mObywatel - Admin Panel</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .admin-container { max-width: 800px; margin: 0 auto; background: white; border-radius: 15px; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.1); }
        .admin-header { text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #f0f0f0; }
        .admin-title { color: #333; font-size: 28px; font-weight: bold; margin-bottom: 10px; }
        .admin-subtitle { color: #666; font-size: 16px; }
        .auth-section { text-align: center; margin-bottom: 30px; }
        .auth-input { padding: 12px 20px; font-size: 16px; border: 2px solid #ddd; border-radius: 8px; margin: 0 10px; width: 200px; }
        .auth-button { padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; transition: background 0.3s ease; }
        .auth-button:hover { background: #0056b3; }
        .settings-section { display: none; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-weight: bold; color: #333; margin-bottom: 5px; font-size: 14px; }
        .form-group input, .form-group select { padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; transition: border-color 0.3s ease; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #007bff; }
        .full-width { grid-column: 1 / -1; }
        .action-buttons { text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid #f0f0f0; }
        .save-button { padding: 15px 30px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; margin: 0 10px; transition: background 0.3s ease; }
        .save-button:hover { background: #1e7e34; }
        .sync-button { padding: 15px 30px; background: #ffc107; color: #212529; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; margin: 0 10px; transition: background 0.3s ease; }
        .sync-button:hover { background: #e0a800; }
        .preview-button { padding: 15px 30px; background: #17a2b8; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; margin: 0 10px; transition: background 0.3s ease; }
        .preview-button:hover { background: #138496; }
        .success-message { background: #d4edda; color: #155724; padding: 15px 20px; border-radius: 8px; margin: 15px 0; display: none; border-left: 4px solid #28a745; }
        .error-message { background: #f8d7da; color: #721c24; padding: 15px 20px; border-radius: 8px; margin: 15px 0; display: none; border-left: 4px solid #dc3545; }
        .sync-url { background: #f8f9fa; border: 1px solid #ddd; padding: 15px; border-radius: 6px; margin: 15px 0; font-family: monospace; font-size: 12px; word-break: break-all; }
        .instructions { background: #e7f3ff; border-left: 4px solid #007bff; padding: 15px; margin: 20px 0; border-radius: 6px; }
        @media (max-width: 768px) { .form-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1 class="admin-title">üîß Panel Administratora</h1>
            <p class="admin-subtitle">Vercel Solution - Sync data across all devices instantly!</p>
        </div>

        <div class="auth-section" id="authSection">
            <p style="margin-bottom: 15px; color: #666;">Wprowad≈∫ has≈Ço administratora:</p>
            <input type="password" id="adminPassword" class="auth-input" placeholder="Has≈Ço">
            <button onclick="authenticate()" class="auth-button">Zaloguj</button>
            <div id="authError" class="error-message"></div>
        </div>

        <div class="settings-section" id="settingsSection">
            <form id="globalSettingsForm">
                <div class="form-grid">
                    <div class="form-group"><label for="name">Imiƒô (imiona)</label><input type="text" id="name" name="name"></div>
                    <div class="form-group"><label for="surname">Nazwisko</label><input type="text" id="surname" name="surname"></div>
                    <div class="form-group"><label for="nationality">Obywatelstwo</label><input type="text" id="nationality" name="nationality"></div>
                    <div class="form-group"><label for="birthday">Data urodzenia (DD.MM.YYYY)</label><input type="text" id="birthday" name="birthday"></div>
                    <div class="form-group"><label for="pesel">Numer PESEL</label><input type="text" id="pesel" name="pesel"></div>
                    <div class="form-group"><label for="sex">P≈Çeƒá</label><select id="sex" name="sex"><option value="Mƒô≈ºczyzna">Mƒô≈ºczyzna</option><option value="Kobieta">Kobieta</option></select></div>
                    <div class="form-group"><label for="familyName">Nazwisko rodowe</label><input type="text" id="familyName" name="familyName"></div>
                    <div class="form-group"><label for="fathersFamilyName">Nazwisko rodowe ojca</label><input type="text" id="fathersFamilyName" name="fathersFamilyName"></div>
                    <div class="form-group"><label for="mothersFamilyName">Nazwisko rodowe matki</label><input type="text" id="mothersFamilyName" name="mothersFamilyName"></div>
                    <div class="form-group"><label for="birthPlace">Miejsce urodzenia</label><input type="text" id="birthPlace" name="birthPlace"></div>
                    <div class="form-group"><label for="countryOfBirth">Kraj urodzenia</label><input type="text" id="countryOfBirth" name="countryOfBirth"></div>
                    <div class="form-group"><label for="mothersName">Imiƒô matki</label><input type="text" id="mothersName" name="mothersName"></div>
                    <div class="form-group"><label for="fathersName">Imiƒô ojca</label><input type="text" id="fathersName" name="fathersName"></div>
                    <div class="form-group"><label for="seriesAndNumber">Seria i numer dowodu</label><input type="text" id="seriesAndNumber" name="seriesAndNumber"></div>
                    <div class="form-group"><label for="givenDate">Data wydania</label><input type="text" id="givenDate" name="givenDate"></div>
                    <div class="form-group"><label for="expiryDate">Data wyga≈õniƒôcia</label><input type="text" id="expiryDate" name="expiryDate"></div>
                    <div class="form-group full-width"><label for="adress1">Ulica i numer domu</label><input type="text" id="adress1" name="adress1"></div>
                    <div class="form-group"><label for="adress2">Kod pocztowy</label><input type="text" id="adress2" name="adress2"></div>
                    <div class="form-group"><label for="city">Miasto</label><input type="text" id="city" name="city"></div>
                    <div class="form-group full-width"><label for="image">Link do zdjƒôcia (Imgur)</label><input type="text" id="image" name="image"></div>
                </div>

                <div class="action-buttons">
                    <button type="button" onclick="saveAndSync()" class="save-button">üíæ Zapisz lokalnie</button>
                    <button type="button" onclick="generateSyncUrl()" class="sync-button">üîó Generuj link sync</button>
                    <button type="button" onclick="previewCard()" class="preview-button">üëÅÔ∏è PodglƒÖd karty</button>
                </div>

                <div id="successMessage" class="success-message"></div>
                <div id="errorMessage" class="error-message"></div>

                <div class="instructions" id="syncInstructions" style="display: none;">
                    <h3>üì± Instrukcja synchronizacji miƒôdzy urzƒÖdzeniami:</h3>
                    <p><strong>Krok 1:</strong> Skopiuj link poni≈ºej</p>
                    <p><strong>Krok 2:</strong> Otw√≥rz ten link na innych urzƒÖdzeniach (telefon, tablet)</p>
                    <p><strong>Krok 3:</strong> Dane automatycznie siƒô zsynchronizujƒÖ!</p>
                </div>

                <div id="syncUrl" class="sync-url" style="display: none;"></div>
            </form>
        </div>
    </div>

    <script>
        const ADMIN_PASSWORD = 'admin123'; // Change this!

        // Load data from URL parameters when page loads
        window.addEventListener('load', loadFromUrl);

        function loadFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const syncData = urlParams.get('sync');

            if (syncData) {
                try {
                    const decodedData = JSON.parse(atob(syncData));
                    // Store the synced data
                    localStorage.setItem('globalCardData', JSON.stringify(decodedData));
                    // Show success message
                    showMessage('success', '‚úÖ Dane zosta≈Çy zsynchronizowane z innego urzƒÖdzenia!');
                    // Remove sync parameter from URL
                    window.history.replaceState({}, document.title, window.location.pathname);
                } catch (error) {
                    console.error('Error loading sync data:', error);
                }
            }
        }

        function authenticate() {
            const password = document.getElementById('adminPassword').value;
            const errorDiv = document.getElementById('authError');
            if (password === ADMIN_PASSWORD) {
                document.getElementById('authSection').style.display = 'none';
                document.getElementById('settingsSection').style.display = 'block';
                loadCurrentSettings();
            } else {
                errorDiv.style.display = 'block';
                errorDiv.textContent = 'Nieprawid≈Çowe has≈Ço!';
            }
        }

        function loadCurrentSettings() {
            const savedData = localStorage.getItem('globalCardData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    Object.keys(data).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) element.value = data[key] || '';
                    });
                } catch (error) {
                    console.error('Error loading settings:', error);
                }
            }
        }

        function saveAndSync() {
            const form = document.getElementById('globalSettingsForm');
            const formData = new FormData(form);
            const globalData = {};

            for (let [key, value] of formData.entries()) {
                globalData[key] = value;
            }

            globalData.adress = (globalData.adress1 || '') + ' ' + (globalData.adress2 || '') + ', ' + (globalData.city || '');
            globalData.timestamp = new Date().toISOString();

            // Save to localStorage
            localStorage.setItem('globalCardData', JSON.stringify(globalData));

            showMessage('success', '‚úÖ Dane zapisane! U≈ºyj "Generuj link sync" aby zsynchronizowaƒá z innymi urzƒÖdzeniami.');
        }

        function generateSyncUrl() {
            const savedData = localStorage.getItem('globalCardData');
            if (!savedData) {
                showMessage('error', '‚ùå Najpierw zapisz dane!');
                return;
            }

            try {
                // Encode data as base64 for URL
                const encodedData = btoa(savedData);
                const currentUrl = window.location.origin + window.location.pathname.replace('admin.html', 'main.html');
                const syncUrl = `${currentUrl}?sync=${encodedData}`;

                // Show the sync URL
                document.getElementById('syncUrl').textContent = syncUrl;
                document.getElementById('syncUrl').style.display = 'block';
                document.getElementById('syncInstructions').style.display = 'block';

                // Copy to clipboard
                navigator.clipboard.writeText(syncUrl).then(() => {
                    showMessage('success', 'üîó Link synchronizacji zosta≈Ç skopiowany do schowka! Otw√≥rz go na innych urzƒÖdzeniach.');
                }).catch(() => {
                    showMessage('success', 'üîó Link synchronizacji zosta≈Ç wygenerowany. Skopiuj go rƒôcznie i otw√≥rz na innych urzƒÖdzeniach.');
                });

            } catch (error) {
                showMessage('error', '‚ùå B≈ÇƒÖd podczas generowania linku: ' + error.message);
            }
        }

        function previewCard() {
            window.open('card.html', '_blank');
        }

        function showMessage(type, text) {
            const successDiv = document.getElementById('successMessage');
            const errorDiv = document.getElementById('errorMessage');
            if (type === 'success') {
                successDiv.style.display = 'block';
                successDiv.innerHTML = text;
                errorDiv.style.display = 'none';
            } else {
                errorDiv.style.display = 'block';
                errorDiv.innerHTML = text;
                successDiv.style.display = 'none';
            }
            setTimeout(() => {
                successDiv.style.display = 'none';
                errorDiv.style.display = 'none';
            }, 8000);
        }

        document.getElementById('adminPassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') authenticate();
        });
    </script>
</body>
</html>
