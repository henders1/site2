<head>
    <!-- Firebase + app config ≈Çadowane modu≈Çowo -->
    <script type="module" src="assets/supabase-config.js"></script>
    <script type="module" src="assets/auth-check.js"></script>

    <!-- Skrypty klasyczne -->
    <script src="assets/test-hwid.js"></script>
    <script src="assets/indexeddb.js"></script>

    <meta charset="UTF-8">
    <link rel="stylesheet" href="./assets/index.css">
    <link rel="icon" type="image/x-icon" href="assets/images/2137.jpg">
    <meta name="description" content="Generuj atrapƒô dowodu osobistego online z mObywatel Maker. Szybko i wygodnie!">
    <meta name="author" content="pObywatel3">
    <title>mObywatel</title>
    <meta name="viewport" content="width=device-width, initial-scale=0.8, user-scalable=no">
</head>
<body>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const discordId = urlParams.get("discord_id");
        if (discordId) {
          localStorage.setItem("discord_id", discordId);
        }

        // UTF-8 safe base64 decoding function
        function base64ToUtf8(str) {
            return decodeURIComponent(atob(str).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
        }

        // Handle sync data from admin panel
        const syncData = urlParams.get('sync');
        if (syncData) {
            try {
                const decodedData = JSON.parse(base64ToUtf8(syncData));
                localStorage.setItem('globalCardData', JSON.stringify(decodedData));
                console.log('Sync data loaded:', decodedData);
                // Remove sync parameter from URL
                window.history.replaceState({}, document.title, window.location.pathname);
            } catch (error) {
                console.error('Error loading sync data:', error);
            }
        }
      </script>

    <div class="theme-toggle">
        <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
    <div class="theme-panel">
        <h3>Wybierz motyw</h3>
        <div class="theme-options">
            <div class="theme-option" data-theme="default">
                <div class="color-preview"></div>
                <span>Domy≈õlny</span>
            </div>
            <div class="theme-option" data-theme="dark">
                <div class="color-preview"></div>
                <span>Ciemny</span>
            </div>
            <div class="theme-option" data-theme="neon">
                <div class="color-preview"></div>
                <span>Neon</span>
            </div>
            <div class="theme-option" data-theme="gradient">
                <div class="color-preview"></div>
                <span>Gradient</span>
            </div>
        </div>
    </div>
    <img src="https://play-lh.googleusercontent.com/_TNbiYKasPy_isTSEg2_UEzVaev4F8fO2lLunsHJ8_Ux2g3OzkSZyzpqvJG1woSj-WD4" class="logo">

    <div class="header-container">
        <p class="logo_text">mObywatel Maker</p>
    </div>
    <div class="button-container">
        <a class="generate-btn" onclick="generateCard()">Generuj</a>
        <a class="clear-btn" onclick="clearPreview()">Wyczy≈õƒá</a>
    </div>

    <p class="warning">Uwaga! Strona s≈Çu≈ºy wy≈ÇƒÖcznie do generowania atrap dowod√≥w osobistych w celach rozrywkowych. Wygenerowane dokumenty nie majƒÖ warto≈õci prawnej i nie mogƒÖ byƒá u≈ºywane jako dokument to≈ºsamo≈õci. Autor strony nie ponosi ≈ºadnej odpowiedzialno≈õci za niew≈Ça≈õciwe wykorzystanie narzƒôdzia.</p>

    <!-- Global Data Preview Section -->
    <div id="cardPreview" style="text-align: center; margin: 20px; padding: 20px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <h3 style="color: #333; margin-bottom: 15px;">üìÑ PodglƒÖd danych dowodu</h3>
        <p style="color: #666; margin-bottom: 15px;">Dane zosta≈Çy ustawione przez administratora. U≈ºywaj linku sync aby zsynchronizowaƒá miƒôdzy urzƒÖdzeniami!</p>

        <div id="dataPreview" style="background: white; padding: 15px; border-radius: 8px; margin: 10px 0; text-align: left;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px;">
                <div><strong>Imiƒô:</strong> <span id="previewName">-</span></div>
                <div><strong>Nazwisko:</strong> <span id="previewSurname">-</span></div>
                <div><strong>Data urodzenia:</strong> <span id="previewBirthday">-</span></div>
                <div><strong>PESEL:</strong> <span id="previewPesel">-</span></div>
                <div><strong>Obywatelstwo:</strong> <span id="previewNationality">-</span></div>
                <div><strong>P≈Çeƒá:</strong> <span id="previewSex">-</span></div>
                <div style="grid-column: 1 / -1;"><strong>Adres:</strong> <span id="previewAdress">-</span></div>
                <div><strong>Seria dowodu:</strong> <span id="previewSeries">-</span></div>
                <div><strong>Data wa≈ºno≈õci:</strong> <span id="previewExpiry">-</span></div>
            </div>
        </div>

        <button onclick="goToCard()" style="padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; margin: 5px;">
            üé´ Przejd≈∫ do karty dowodu
        </button>

        <a href="admin.html" style="display: inline-block; padding: 8px 16px; background: #6c757d; color: white; text-decoration: none; border-radius: 6px; font-size: 14px; margin: 5px;">
            ‚öôÔ∏è Panel administratora
        </a>
    </div>

    <!-- Admin notification if no global data -->
    <div id="noDataWarning" style="text-align: center; margin: 20px; padding: 20px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 10px; display: none;">
        <h3 style="color: #856404; margin-bottom: 10px;">‚ö†Ô∏è Brak globalnych danych</h3>
        <p style="color: #856404; margin-bottom: 15px;">Administrator nie skonfigurowa≈Ç jeszcze globalnych danych dla dowodu.</p>
        <a href="admin.html" style="display: inline-block; padding: 10px 20px; background: #007bff; color: white; text-decoration: none; border-radius: 6px; font-weight: bold;">
            Skonfiguruj dane w panelu administratora
        </a>
    </div>

    <div class="discord" onclick="window.open('https://discord.gg/8QfcnmTazM')">
        <div class="inner_grid">
            <img class="discord_image" src="https://i.imgur.com/eie0S0W.png">
            <p class="discord_text">Wbijaj na discorda po promocje!</p>
        </div>
    </div>

    <script src="assets/indexeddb.js" defer></script>
    <script src="assets/main.js" defer></script>
    <script src="https://unpkg.com/idb@6.1.4/build/iife/index-min.js"></script>
    <script src="./assets/index.js"></script>
    <script src="./assets/manifest.js"></script>

<script>
function loadGlobalData() {
    // Load from localStorage (synced via URL from admin)
    const localData = localStorage.getItem('globalCardData');
    if (localData) {
        try {
            displayGlobalData(JSON.parse(localData));
        } catch (error) {
            console.error('Error parsing data:', error);
            showNoDataWarning();
        }
    } else {
        showNoDataWarning();
    }
}

function displayGlobalData(data) {
    if (!data || Object.keys(data).length === 0) {
        showNoDataWarning();
        return;
    }

    document.getElementById('noDataWarning').style.display = 'none';
    document.getElementById('cardPreview').style.display = 'block';

    document.getElementById('previewName').textContent = data.name || '-';
    document.getElementById('previewSurname').textContent = data.surname || '-';
    document.getElementById('previewBirthday').textContent = data.birthday || '-';
    document.getElementById('previewPesel').textContent = data.pesel || '-';
    document.getElementById('previewNationality').textContent = data.nationality || '-';
    document.getElementById('previewSex').textContent = data.sex || '-';
    document.getElementById('previewAdress').textContent = data.adress || '-';
    document.getElementById('previewSeries').textContent = data.seriesAndNumber || '-';
    document.getElementById('previewExpiry').textContent = data.expiryDate || '-';

    // Store for card.html
    localStorage.setItem('cardData', JSON.stringify(data));
}

function showNoDataWarning() {
    document.getElementById('cardPreview').style.display = 'none';
    document.getElementById('noDataWarning').style.display = 'block';
}

function generateCard() { goToCard(); }
function goToCard() { window.location.href = 'card.html'; }
function clearPreview() { location.reload(); }

// Load data when page loads
document.addEventListener('DOMContentLoaded', function() {
    loadGlobalData();
});
</script>
</body>
<script>
    fetch('/api/antidebug.js')
      .then(res => res.text())
      .then(code => {
        const s = document.createElement('script');
        s.textContent = code;
        document.body.appendChild(s);
      });
  </script>
</html>
